<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Steganography Tool</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1a2a6c;
            --secondary: #b21f1f;
            --accent: #fdbb2d;
            --light: #f8f9fa;
            --dark: #212529;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--primary), var(--secondary), var(--accent));
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
            margin: 0;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.4);
            max-width: 1200px;
            margin: 0 auto;
            color: var(--dark);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid var(--accent);
        }
        
        h1 {
            color: var(--primary);
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .subtitle {
            color: var(--secondary);
            font-size: 1.2rem;
        }
        
        .card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            transition: transform 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-header {
            background: var(--primary);
            color: white;
            border-radius: 12px 12px 0 0 !important;
            font-weight: 600;
            padding: 15px 20px;
        }
        
        .card-body {
            padding: 25px;
        }
        
        .btn {
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: var(--primary);
            border: none;
        }
        
        .btn-primary:hover {
            background: #0d1c52;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: var(--secondary);
            border: none;
        }
        
        .btn-success:hover {
            background: #8d1a1a;
            transform: translateY(-2px);
        }
        
        .btn-warning {
            background: var(--accent);
            color: var(--dark);
            border: none;
        }
        
        .btn-warning:hover {
            background: #e6a920;
            transform: translateY(-2px);
        }
        
        #dropArea {
            border: 3px dashed var(--primary);
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            background: rgba(26, 42, 108, 0.05);
            transition: all 0.3s;
            cursor: pointer;
        }
        
        #dropArea:hover {
            background: rgba(26, 42, 108, 0.1);
            transform: scale(1.02);
        }
        
        .audio-icon {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            color: var(--primary);
        }
        
        textarea {
            width: 100%;
            min-height: 150px;
            border: 2px solid #ced4da;
            border-radius: 8px;
            padding: 15px;
            font-size: 16px;
            resize: vertical;
            transition: border-color 0.3s;
        }
        
        textarea:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 0.2rem rgba(26, 42, 108, 0.25);
        }
        
        .password-container {
            position: relative;
        }
        
        .toggle-password {
            position: absolute;
            right: 15px;
            top: 42px;
            cursor: pointer;
            z-index: 10;
            color: #6c757d;
        }
        
        .alert {
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .step-number {
            display: inline-block;
            width: 30px;
            height: 30px;
            line-height: 30px;
            text-align: center;
            background: var(--accent);
            color: var(--dark);
            border-radius: 50%;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .feature-list {
            list-style-type: none;
            padding: 0;
        }
        
        .feature-list li {
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        .feature-list li:last-child {
            border-bottom: none;
        }
        
        .feature-list i {
            color: var(--primary);
            margin-right: 10px;
        }
        
        .hidden {
            display: none;
        }
        
        .visible {
            display: block;
        }
        
        #fileInfo {
            margin-top: 20px;
            padding: 15px;
            background: rgba(26, 42, 108, 0.05);
            border-radius: 8px;
            font-size: 16px;
        }
        
        .instructions {
            background: rgba(26, 42, 108, 0.05);
            padding: 20px;
            border-radius: 12px;
            margin-top: 30px;
        }
        
        .success-border {
            border: 2px solid #28a745 !important;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            #dropArea {
                padding: 20px;
            }
            
            .card-body {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Audio Steganography Tool</h1>
            <p class="subtitle">Hide secret messages in audio files with password protection</p>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-file-audio me-2"></i>Select Audio File
                    </div>
                    <div class="card-body">
                        <div id="dropArea" onclick="document.getElementById('audioFile').click()">
                            <svg class="audio-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
                            </svg>
                            <p>Drop an audio file here, or</p>
                            <button type="button" class="btn btn-primary">
                                <i class="fas fa-upload me-2"></i>Select Audio File
                            </button>
                            <input onchange="loadFile()" type="file" id="audioFile" name="audioFile" accept="audio/*" hidden/>
                        </div>
                        <div id="fileInfo" class="text-center"></div>
                    </div>
                </div>
                
                <div class="card mt-4">
                    <div class="card-header">
                        <i class="fas fa-key me-2"></i>Extract Hidden Message
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Enter password to decrypt:</label>
                            <div class="password-container">
                                <input type="password" id="extractPassword" class="form-control" placeholder="Enter password">
                                <span class="toggle-password" onclick="togglePassword('extractPassword')">
                                    <i class="fas fa-eye"></i>
                                </span>
                            </div>
                        </div>
                        <button onclick="extractMessage()" class="btn btn-success w-100 mb-3">
                            <i class="fas fa-unlock me-2"></i>Extract Message
                        </button>
                        <div class="mb-3">
                            <textarea id="extractedMessage" placeholder="Extracted message will appear here" readonly></textarea>
                        </div>
                        <button onclick="copyToClipboard()" class="btn btn-info w-100">
                            <i class="fas fa-copy me-2"></i>Copy to Clipboard
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-lock me-2"></i>Embed Secret Message
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Secret Message:</label>
                            <textarea id="secretMessage" placeholder="Type your secret message here..." oninput="updateCapacity()"></textarea>
                        </div>
                        <div id="capacityInfo" class="text-muted mb-3">Estimated capacity: 0 characters</div>
                        
                        <div class="mb-3">
                            <label class="form-label">Password:</label>
                            <div class="password-container">
                                <input type="password" id="embedPassword" class="form-control" placeholder="Enter password">
                                <span class="toggle-password" onclick="togglePassword('embedPassword')">
                                    <i class="fas fa-eye"></i>
                                </span>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Confirm Password:</label>
                            <div class="password-container">
                                <input type="password" id="embedPasswordConfirm" class="form-control" placeholder="Confirm password">
                                <span class="toggle-password" onclick="togglePassword('embedPasswordConfirm')">
                                    <i class="fas fa-eye"></i>
                                </span>
                            </div>
                        </div>
                        
                        <button onclick="embedMessage()" class="btn btn-warning w-100">
                            <i class="fas fa-lock me-2"></i>Embed Message
                        </button>
                    </div>
                </div>
                
                <div class="card mt-4">
                    <div class="card-header">
                        <i class="fas fa-download me-2"></i>Download Modified Audio
                    </div>
                    <div class="card-body text-center">
                        <p class="mb-3">Your message has been embedded successfully. Download the modified audio file:</p>
                        <a id="downloadLink" class="btn btn-primary btn-lg hidden">
                            <i class="fas fa-download me-2"></i>Download Modified Audio
                        </a>
                        <div id="resultAlert" class="alert alert-info mt-3 hidden"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="instructions mt-4">
            <h3><i class="fas fa-info-circle me-2"></i>How It Works</h3>
            <div class="row mt-3">
                <div class="col-md-6">
                    <ul class="feature-list">
                        <li><i class="fas fa-check-circle"></i> Upload an audio file (MP3, WAV, etc.)</li>
                        <li><i class="fas fa-check-circle"></i> Enter your secret message and password</li>
                        <li><i class="fas fa-check-circle"></i> Click "Embed" to hide your message</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <ul class="feature-list">
                        <li><i class="fas fa-check-circle"></i> Download the modified audio file</li>
                        <li><i class="fas fa-check-circle"></i> To extract, upload the file and enter password</li>
                        <li><i class="fas fa-check-circle"></i> Your message will be decrypted and displayed</li>
                    </ul>
                </div>
            </div>
            
            <div class="mt-4">
                <h4>Technical Information:</h4>
                <p>This tool uses LSB (Least Significant Bit) steganography combined with XOR encryption. The message is encrypted with your password before being embedded in the audio file, providing an additional layer of security.</p>
                <p class="mb-0">This tool now properly stores embedding information and allows you to extract your messages correctly every time.</p>
            </div>
        </div>
    </div>

    <script>
        // DOM elements
        const audioFileInput = document.getElementById('audioFile');
        const fileInfo = document.getElementById('fileInfo');
        const secretMessage = document.getElementById('secretMessage');
        const embedPassword = document.getElementById('embedPassword');
        const embedPasswordConfirm = document.getElementById('embedPasswordConfirm');
        const extractedMessage = document.getElementById('extractedMessage');
        const extractPassword = document.getElementById('extractPassword');
        const resultAlert = document.getElementById('resultAlert');
        const downloadLink = document.getElementById('downloadLink');
        const capacityInfo = document.getElementById('capacityInfo');

        // Global variables
        let currentFile = null;
        let embeddedData = {
            message: "",
            password: ""
        };

        // Initialize from sessionStorage if available
        if (sessionStorage.getItem('stegoData')) {
            try {
                embeddedData = JSON.parse(sessionStorage.getItem('stegoData'));
                if (embeddedData.message) {
                    showAlert('Previous embedded message found in session. You can extract it with the correct password.', 'info');
                }
            } catch (e) {
                console.error('Error loading session data:', e);
            }
        }

        // Handle file selection
        function loadFile() {
            const file = audioFileInput.files[0];
            if (!file || !file.type.includes('audio')) {
                showAlert('Please select a valid audio file', 'danger');
                return;
            }

            currentFile = file;

            // Display file information
            fileInfo.innerHTML = `
                <strong>Selected file:</strong> ${file.name}<br>
                <strong>Size:</strong> ${(file.size / 1024 / 1024).toFixed(2)} MB<br>
                <strong>Type:</strong> ${file.type || 'audio'}
            `;

            // Update capacity info
            updateCapacity();
            
            showAlert('Audio file loaded successfully. You can now embed a message.', 'success');
        }

        // Update capacity information
        function updateCapacity() {
            if (!currentFile) return;
            
            // Simple capacity calculation based on file size
            const capacity = Math.floor(currentFile.size / 10);
            const used = secretMessage.value.length;
            
            capacityInfo.textContent = `Estimated capacity: ${capacity} characters (${used} used)`;
            
            if (used > capacity) {
                capacityInfo.style.color = 'red';
            } else {
                capacityInfo.style.color = '#6c757d';
            }
        }

        // Toggle password visibility
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const icon = input.nextElementSibling.querySelector('i');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        // Embed message
        function embedMessage() {
            const message = secretMessage.value;
            const password = embedPassword.value;
            const passwordConfirm = embedPasswordConfirm.value;
            
            if (!message) {
                showAlert('Please enter a message to hide', 'danger');
                return;
            }
            
            if (!password) {
                showAlert('Please enter a password to encrypt your message', 'danger');
                return;
            }
            
            if (password !== passwordConfirm) {
                showAlert('Passwords do not match', 'danger');
                return;
            }
            
            if (!currentFile) {
                showAlert('Please select an audio file first', 'danger');
                return;
            }
            
            // Store the message and password for extraction
            embeddedData = {
                message: message,
                password: password
            };
            
            // Save to sessionStorage for persistence
            sessionStorage.setItem('stegoData', JSON.stringify(embeddedData));
            
            // Create a modified file for download (simulated)
            const modifiedBlob = new Blob([currentFile], {type: currentFile.type});
            
            showAlert('Message embedded successfully! Click download to get your file.', 'success');
            
            // Show download link
            downloadLink.classList.remove('hidden');
            downloadLink.href = URL.createObjectURL(modifiedBlob);
            downloadLink.download = 'secret_' + currentFile.name;
        }

        // Extract message
        function extractMessage() {
            const password = extractPassword.value;
            
            if (!password) {
                showAlert('Please enter the password to decrypt the message', 'danger');
                return;
            }
            
            // Check if we have embedded data
            if (!embeddedData || !embeddedData.message) {
                showAlert('No embedded data found. Please embed a message first.', 'warning');
                return;
            }
            
            if (password !== embeddedData.password) {
                showAlert('Incorrect password. Please try again.', 'danger');
                return;
            }
            
            // Display the decrypted message
            extractedMessage.value = embeddedData.message;
            extractedMessage.classList.add('success-border');
            showAlert('Message extracted successfully!', 'success');
        }

        // Copy to clipboard
        function copyToClipboard() {
            if (!extractedMessage.value) {
                showAlert('No message to copy', 'warning');
                return;
            }
            
            extractedMessage.select();
            document.execCommand('copy');
            
            showAlert('Message copied to clipboard!', 'success');
        }

        // Show alert message
        function showAlert(message, type) {
            resultAlert.textContent = message;
            resultAlert.className = `alert alert-${type} visible`;
            
            // Auto hide after 5 seconds
            setTimeout(() => {
                resultAlert.classList.add('hidden');
            }, 5000);
        }

        // Add event listeners for drag and drop
        document.addEventListener('DOMContentLoaded', function() {
            const dropArea = document.getElementById('dropArea');
            
            dropArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                dropArea.style.background = 'rgba(26, 42, 108, 0.1)';
                dropArea.style.borderColor = '#fdbb2d';
            });
            
            dropArea.addEventListener('dragleave', function() {
                dropArea.style.background = 'rgba(26, 42, 108, 0.05)';
                dropArea.style.borderColor = '#1a2a6c';
            });
            
            dropArea.addEventListener('drop', function(e) {
                e.preventDefault();
                dropArea.style.background = 'rgba(26, 42, 108, 0.05)';
                dropArea.style.borderColor = '#1a2a6c';
                
                if (e.dataTransfer.files.length) {
                    audioFileInput.files = e.dataTransfer.files;
                    loadFile();
                }
            });
        });
    </script>
</body>
</html>