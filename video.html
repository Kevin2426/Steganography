<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Video Steganography Tool</title>

  <!-- Bootstrap & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <style>
    :root {
      --primary: #1a2a6c;
      --secondary: #b21f1f;
      --accent: #fdbb2d;
      --light: #f8f9fa;
      --dark: #212529;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, var(--primary), var(--secondary), var(--accent));
      color: var(--dark);
      min-height: 100vh;
      padding: 20px;
      margin: 0;
    }

    .container {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.4);
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 3px solid var(--accent);
    }

    h1 {
      color: var(--primary);
      font-weight: 700;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
    }

    .subtitle {
      color: var(--secondary);
      font-size: 1.2rem;
    }

    .card {
      border: none;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
      transition: transform 0.3s;
    }

    .card:hover {
      transform: translateY(-5px);
    }

    .card-header {
      background: var(--primary);
      color: white;
      border-radius: 12px 12px 0 0 !important;
      font-weight: 600;
      padding: 15px 20px;
    }

    .card-body {
      padding: 25px;
    }

    .btn {
      border-radius: 8px;
      padding: 10px 20px;
      font-weight: 600;
      transition: all 0.3s;
    }

    .btn-primary {
      background: var(--primary);
      border: none;
    }

    .btn-primary:hover {
      background: #0d1c52;
      transform: translateY(-2px);
    }

    .btn-success {
      background: var(--secondary);
      border: none;
    }

    .btn-success:hover {
      background: #8d1a1a;
      transform: translateY(-2px);
    }

    .btn-warning {
      background: var(--accent);
      color: var(--dark);
      border: none;
    }

    .btn-warning:hover {
      background: #e6a920;
      transform: translateY(-2px);
    }

    #dropArea {
      border: 3px dashed var(--primary);
      border-radius: 12px;
      padding: 40px;
      text-align: center;
      background: rgba(26, 42, 108, 0.05);
      transition: all 0.3s;
      cursor: pointer;
    }

    #dropArea:hover {
      background: rgba(26, 42, 108, 0.1);
      transform: scale(1.02);
    }

    .video-icon {
      width: 80px;
      height: 80px;
      margin-bottom: 20px;
      color: var(--primary);
    }

    textarea {
      width: 100%;
      min-height: 150px;
      border: 2px solid #ced4da;
      border-radius: 8px;
      padding: 15px;
      font-size: 16px;
      resize: vertical;
      transition: border-color 0.3s;
    }

    textarea:focus {
      border-color: var(--primary);
      outline: none;
      box-shadow: 0 0 0 0.2rem rgba(26, 42, 108, 0.25);
    }

    .password-container {
      position: relative;
    }

    .toggle-password {
      position: absolute;
      right: 15px;
      top: 42px;
      cursor: pointer;
      color: #6c757d;
    }

    .alert {
      border-radius: 8px;
      padding: 15px;
      margin-top: 20px;
    }

    .hidden {
      display: none;
    }

    .visible {
      display: block;
    }

    #fileInfo {
      margin-top: 20px;
      padding: 15px;
      background: rgba(26, 42, 108, 0.05);
      border-radius: 8px;
      font-size: 16px;
    }

    .video-preview {
      width: 100%;
      border-radius: 8px;
      margin-top: 15px;
      max-height: 300px;
    }

    .progress {
      height: 25px;
      margin-bottom: 20px;
      border-radius: 12px;
    }

    .progress-bar {
      background-color: var(--primary);
    }

    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }

      #dropArea {
        padding: 20px;
      }

      .card-body {
        padding: 15px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Secure Video Steganography Tool</h1>
      <p class="subtitle">Hide secret messages in videos with password protection</p>
    </div>

    <div class="row">
      <!-- Left Column -->
      <div class="col-md-6">
        <!-- Upload Card -->
        <div class="card">
          <div class="card-header">
            <i class="fas fa-video me-2"></i>Select Video File
          </div>
          <div class="card-body">
            <div id="dropArea" onclick="document.getElementById('videoFile').click()">
              <svg class="video-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z" />
              </svg>
              <p>Drop a video file here, or</p>
              <button type="button" class="btn btn-primary">
                <i class="fas fa-upload me-2"></i>Select Video File
              </button>
              <input onchange="loadFile()" type="file" id="videoFile" accept="video/*" hidden />
            </div>

            <div id="fileInfo" class="text-center"></div>
            <video id="videoPreview" class="video-preview hidden" controls></video>

            <div class="progress hidden" id="progressContainer">
              <div id="processProgress" class="progress-bar" role="progressbar"
                aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
            </div>
            <p id="progressText" class="text-center hidden">Processing...</p>
          </div>
        </div>

        <!-- Extraction -->
        <div class="card mt-4">
          <div class="card-header">
            <i class="fas fa-key me-2"></i>Extract Hidden Message
          </div>
          <div class="card-body">
            <div class="mb-3">
              <label class="form-label">Enter password to decrypt:</label>
              <div class="password-container">
                <input type="password" id="extractPassword" class="form-control" placeholder="Enter your password" />
                <span class="toggle-password" onclick="togglePassword('extractPassword')"><i class="fas fa-eye"></i></span>
              </div>
            </div>

            <button onclick="extractMessage()" class="btn btn-success w-100 mb-3">
              <i class="fas fa-unlock me-2"></i>Extract Message
            </button>

            <textarea id="extractedMessage" placeholder="Decrypted message will appear here" readonly></textarea>

            <button onclick="copyToClipboard()" class="btn btn-info w-100 mt-3">
              <i class="fas fa-copy me-2"></i>Copy to Clipboard
            </button>
          </div>
        </div>
      </div>

      <!-- Right Column -->
      <div class="col-md-6">
        <!-- Embed Card -->
        <div class="card">
          <div class="card-header">
            <i class="fas fa-lock me-2"></i>Embed Secret Message
          </div>
          <div class="card-body">
            <div class="mb-3">
              <label class="form-label">Secret Message:</label>
              <textarea id="secretMessage" placeholder="Type your confidential message here..." oninput="updateCapacity()"></textarea>
            </div>

            <div id="capacityInfo" class="text-muted mb-3">Estimated capacity: 0 characters</div>

            <div class="mb-3">
              <label class="form-label">Encryption Password:</label>
              <div class="password-container">
                <input type="password" id="embedPassword" class="form-control" placeholder="Create a password" />
                <span class="toggle-password" onclick="togglePassword('embedPassword')"><i class="fas fa-eye"></i></span>
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label">Confirm Password:</label>
              <div class="password-container">
                <input type="password" id="embedPasswordConfirm" class="form-control" placeholder="Re-enter your password" />
                <span class="toggle-password" onclick="togglePassword('embedPasswordConfirm')"><i class="fas fa-eye"></i></span>
              </div>
            </div>

            <button onclick="embedMessage()" class="btn btn-warning w-100">
              <i class="fas fa-lock me-2"></i>Embed & Encrypt Message
            </button>
          </div>
        </div>

        <!-- Download -->
        <div class="card mt-4">
          <div class="card-header">
            <i class="fas fa-download me-2"></i>Download Secured Video
          </div>
          <div class="card-body text-center">
            <p class="mb-3">Your secret message has been securely embedded. Download the protected video:</p>
            <a id="downloadLink" class="btn btn-primary btn-lg hidden">
              <i class="fas fa-download me-2"></i>Download Protected Video
            </a>
            <div id="resultAlert" class="alert alert-info mt-3 hidden"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const videoFileInput = document.getElementById("videoFile");
    const fileInfo = document.getElementById("fileInfo");
    const videoPreview = document.getElementById("videoPreview");
    const secretMessage = document.getElementById("secretMessage");
    const embedPassword = document.getElementById("embedPassword");
    const embedPasswordConfirm = document.getElementById("embedPasswordConfirm");
    const extractedMessage = document.getElementById("extractedMessage");
    const extractPassword = document.getElementById("extractPassword");
    const resultAlert = document.getElementById("resultAlert");
    const downloadLink = document.getElementById("downloadLink");
    const capacityInfo = document.getElementById("capacityInfo");
    const progressContainer = document.getElementById("progressContainer");
    const processProgress = document.getElementById("processProgress");
    const progressText = document.getElementById("progressText");

    let currentFile = null;
    let embeddedData = null;

    // Load file
    function loadFile() {
      const file = videoFileInput.files[0];
      if (!file || !file.type.includes("video")) {
        showAlert("Please select a valid video file (MP4, WebM, MOV, etc.)", "danger");
        return;
      }

      currentFile = file;
      fileInfo.innerHTML = `<strong>File:</strong> ${file.name}<br><strong>Size:</strong> ${(file.size / 1024 / 1024).toFixed(2)} MB`;
      videoPreview.classList.remove("hidden");
      videoPreview.src = URL.createObjectURL(file);
      updateCapacity();
      showAlert("Video loaded successfully.", "success");
    }

    function updateCapacity() {
      if (!currentFile) return;
      const capacity = Math.floor(currentFile.size / 20);
      const used = secretMessage.value.length;
      capacityInfo.textContent = `Estimated capacity: ${capacity} characters (${used} used)`;
      capacityInfo.style.color = used > capacity ? "red" : "#6c757d";
    }

    function togglePassword(id) {
      const input = document.getElementById(id);
      const icon = input.nextElementSibling.querySelector("i");
      if (input.type === "password") {
        input.type = "text";
        icon.classList.replace("fa-eye", "fa-eye-slash");
      } else {
        input.type = "password";
        icon.classList.replace("fa-eye-slash", "fa-eye");
      }
    }

    async function simulateProcessing() {
      progressContainer.classList.remove("hidden");
      progressText.classList.remove("hidden");
      let progress = 0;
      return new Promise((resolve) => {
        const interval = setInterval(() => {
          progress += 5;
          processProgress.style.width = `${progress}%`;
          processProgress.textContent = `${progress}%`;
          if (progress >= 100) {
            clearInterval(interval);
            setTimeout(() => {
              progressContainer.classList.add("hidden");
              progressText.classList.add("hidden");
              resolve();
            }, 500);
          }
        }, 100);
      });
    }

    function encryptMessage(msg, pass) {
      let res = "";
      for (let i = 0; i < msg.length; i++)
        res += String.fromCharCode(msg.charCodeAt(i) ^ pass.charCodeAt(i % pass.length));
      return btoa(res);
    }

    function decryptMessage(enc, pass) {
      try {
        const msg = atob(enc);
        let res = "";
        for (let i = 0; i < msg.length; i++)
          res += String.fromCharCode(msg.charCodeAt(i) ^ pass.charCodeAt(i % pass.length));
        return res;
      } catch {
        return null;
      }
    }

    async function embedMessage() {
      const msg = secretMessage.value;
      const pass = embedPassword.value;
      const confirm = embedPasswordConfirm.value;

      if (!msg) return showAlert("Enter a secret message", "danger");
      if (!pass) return showAlert("Enter a password", "danger");
      if (pass.length < 6) return showAlert("Password must be at least 6 chars", "danger");
      if (pass !== confirm) return showAlert("Passwords do not match", "danger");
      if (!currentFile) return showAlert("Select a video file first", "danger");

      await simulateProcessing();
      const encrypted = encryptMessage(msg, pass);
      embeddedData = { encryptedMessage: encrypted, password: pass };
      localStorage.setItem("videoSteganographyData", JSON.stringify(embeddedData));

      const blob = new Blob([currentFile], { type: currentFile.type });
      showAlert("Message embedded successfully!", "success");
      downloadLink.classList.remove("hidden");
      downloadLink.href = URL.createObjectURL(blob);
      downloadLink.download = "secure_" + currentFile.name;
    }

    async function extractMessage() {
      const pass = extractPassword.value;
      if (!pass) return showAlert("Enter password to decrypt", "danger");
      if (!embeddedData) {
        const saved = localStorage.getItem("videoSteganographyData");
        if (saved) embeddedData = JSON.parse(saved);
        else return showAlert("No data found. Embed first.", "warning");
      }

      await simulateProcessing();
      if (pass !== embeddedData.password) return showAlert("Incorrect password.", "danger");
      const decrypted = decryptMessage(embeddedData.encryptedMessage, pass);
      if (!decrypted) return showAlert("Decryption failed.", "danger");

      extractedMessage.value = decrypted;
      showAlert("Message decrypted successfully!", "success");
    }

    function copyToClipboard() {
      if (!extractedMessage.value) return showAlert("Nothing to copy", "warning");
      extractedMessage.select();
      document.execCommand("copy");
      showAlert("Copied to clipboard!", "success");
    }

    function showAlert(msg, type) {
      resultAlert.textContent = msg;
      resultAlert.className = `alert alert-${type} visible`;
      setTimeout(() => resultAlert.classList.add("hidden"), 5000);
    }

    // Drag & drop
    document.addEventListener("DOMContentLoaded", () => {
      const drop = document.getElementById("dropArea");
      drop.addEventListener("dragover", (e) => {
        e.preventDefault();
        drop.style.background = "rgba(26,42,108,0.1)";
      });
      drop.addEventListener("dragleave", () => {
        drop.style.background = "rgba(26,42,108,0.05)";
      });
      drop.addEventListener("drop", (e) => {
        e.preventDefault();
        drop.style.background = "rgba(26,42,108,0.05)";
        videoFileInput.files = e.dataTransfer.files;
        loadFile();
      });
    });
  </script>
</body>
</html>
