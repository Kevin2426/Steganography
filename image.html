<!DOCTYPE html>
<html lang="en">
<head>
    <title>Image Steganography with Password</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }
        h1 {
            color: #fdbb2d;
            text-align: center;
            margin-bottom: 20px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        .card {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        .card-img {
            max-height: 300px;
            object-fit: contain;
        }
        .card-img-overlay {
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.5);
            opacity: 0;
            transition: opacity 0.3s;
        }
        .card:hover .card-img-overlay {
            opacity: 1;
        }
        textarea {
            width: 100%;
            min-height: 120px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #6c757d;
            border-radius: 5px;
            color: white;
            padding: 10px;
        }
        .btn {
            margin: 5px;
            transition: all 0.3s;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .password-group {
            margin: 15px 0;
        }
        #description {
            text-align: center;
            margin-bottom: 25px;
            font-size: 1.1em;
            line-height: 1.6;
        }
        #capacity {
            color: #fdbb2d;
            font-weight: bold;
        }
        .invisible {
            display: none;
        }
        .visible {
            display: block;
        }
        .alert {
            margin-top: 15px;
        }
        .instructions {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }
        .instructions h3 {
            color: #fdbb2d;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Image Steganography with Password</h1>
        <div id="description">
            Hide and retrieve secret messages in images using password encryption. Upload an image, enter your message and password, then click "Hide". To retrieve a message, upload the image, enter the password, and click "Read".
        </div>

        <div class="row">
            <div class="col-md-4">
                <div class="card">
                    <img id="img" class="card-img" src="https://images.unsplash.com/photo-1579546929662-711aa81148cf?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80"/>
                    <div class="card-img-overlay">
                        <input id="file" type="file" class="btn btn-light"/>
                    </div>
                </div>
                <div class="password-group">
                    <label for="password" class="form-label">Password:</label>
                    <input type="password" id="password" class="form-control" placeholder="Enter password">
                </div>
            </div>
            
            <div class="col-md-8">
                <h2>Secret Message: <span id="capacity">(Max: 0 characters)</span></h2>
                <textarea id="text" placeholder="Enter your secret message here..."></textarea>
                
                <div class="btns d-flex justify-content-between mt-3">
                    <button id="hide" class="btn btn-warning flex-fill me-2">Hide Message</button>
                    <button id="read" class="btn btn-success flex-fill ms-2">Read Message</button>
                </div>
                
                <div id="messageArea" class="mt-4 invisible">
                    <h3>Extracted Message:</h3>
                    <div class="alert alert-info" id="message"></div>
                    <button id="copy" class="btn btn-info">Copy Text</button>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-md-6">
                <h2>Original Image:</h2>
                <div class="card">
                    <img id="originalImage" class="card-img" src="https://images.unsplash.com/photo-1579546929662-711aa81148cf?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80"/>
                </div>
            </div>
            <div class="col-md-6">
                <h2>Image with Hidden Message:</h2>
                <div class="card">
                    <img id="cover" class="card-img" src=""/>
                    <div class="card-img-overlay">
                        <a id="download" class="btn btn-success" download="secret_image.png">Download Image</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="instructions mt-4">
            <h3>How It Works:</h3>
            <p>This tool uses steganography to hide your message in the image pixels. The message is encrypted with your password before being embedded, providing an extra layer of security.</p>
            <ol>
                <li>Upload an image (PNG or JPEG)</li>
                <li>Enter your secret message and a password</li>
                <li>Click "Hide Message" to encode the message into the image</li>
                <li>Download the image with the hidden message</li>
                <li>To retrieve the message, upload the image and enter the correct password</li>
            </ol>
        </div>
    </div>

    <script>
        // DOM Elements
        const fileInput = document.getElementById('file');
        const passwordInput = document.getElementById('password');
        const textInput = document.getElementById('text');
        const hideButton = document.getElementById('hide');
        const readButton = document.getElementById('read');
        const messageDiv = document.getElementById('message');
        const messageArea = document.getElementById('messageArea');
        const copyButton = document.getElementById('copy');
        const originalImage = document.getElementById('originalImage');
        const coverImage = document.getElementById('cover');
        const downloadLink = document.getElementById('download');
        const capacitySpan = document.getElementById('capacity');

        // Event Listeners
        fileInput.addEventListener('change', handleImageUpload);
        hideButton.addEventListener('click', hideMessage);
        readButton.addEventListener('click', readMessage);
        copyButton.addEventListener('click', copyText);

        // Handle image upload
        function handleImageUpload(e) {
            const file = e.target.files[0];
            if (!file || !file.type.match('image.*')) {
                alert('Please select a valid image file (JPEG or PNG)');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(event) {
                originalImage.src = event.target.result;
                coverImage.src = event.target.result;
                
                // Calculate maximum message capacity
                const img = new Image();
                img.onload = function() {
                    const capacity = Math.floor((img.width * img.height * 3) / 8) - 100; // 3 bits per pixel, minus header
                    capacitySpan.textContent = `(Max: ${capacity} characters)`;
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(file);
        }

        // Hide message in image
        function hideMessage() {
            if (!originalImage.src || originalImage.src.startsWith('data:') === false) {
                alert('Please upload an image first');
                return;
            }

            const message = textInput.value;
            const password = passwordInput.value;

            if (!message) {
                alert('Please enter a message to hide');
                return;
            }

            if (!password) {
                alert('Please enter a password to encrypt your message');
                return;
            }

            // Create a new image to draw on canvas
            const img = new Image();
            img.onload = function() {
                try {
                    // Create canvas
                    const canvas = document.createElement('canvas');
                    canvas.width = img.width;
                    canvas.height = img.height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0);

                    // Get image data
                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    const data = imageData.data;

                    // Encrypt message with password
                    const encryptedMessage = encryptMessage(message, password);
                    
                    // Convert message to binary
                    const binaryMessage = stringToBinary(encryptedMessage);
                    
                    // Add header to identify this as a stego image
                    const header = "STEG1";
                    const fullBinary = stringToBinary(header) + binaryMessage.length.toString(2).padStart(32, '0') + binaryMessage;
                    
                    // Check if message fits in image
                    if (fullBinary.length > data.length * 4) {
                        alert('Message is too long for this image. Please use a larger image or shorter message.');
                        return;
                    }

                    // Embed message in image data (using LSB of RGB channels)
                    let binaryIndex = 0;
                    for (let i = 0; i < data.length; i += 4) {
                        // Skip alpha channel to maintain transparency
                        for (let j = 0; j < 3; j++) {
                            if (binaryIndex < fullBinary.length) {
                                // Replace LSB with message bit
                                data[i + j] = (data[i + j] & 0xFE) | parseInt(fullBinary[binaryIndex]);
                                binaryIndex++;
                            }
                        }
                    }

                    // Put modified data back to canvas
                    ctx.putImageData(imageData, 0, 0);

                    // Update the cover image and download link
                    coverImage.src = canvas.toDataURL();
                    downloadLink.href = canvas.toDataURL();
                    
                    alert('Message hidden successfully! Download the image using the button below.');
                } catch (error) {
                    console.error('Error hiding message:', error);
                    alert('Error hiding message: ' + error.message);
                }
            };
            img.src = originalImage.src;
        }

        // Read message from image
        function readMessage() {
            if (!coverImage.src || coverImage.src.startsWith('data:') === false) {
                alert('Please upload an image with a hidden message first');
                return;
            }

            const password = passwordInput.value;

            if (!password) {
                alert('Please enter the password to decrypt the message');
                return;
            }

            // Create a new image to draw on canvas
            const img = new Image();
            img.onload = function() {
                try {
                    // Create canvas
                    const canvas = document.createElement('canvas');
                    canvas.width = img.width;
                    canvas.height = img.height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0);

                    // Get image data
                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    const data = imageData.data;

                    // Extract binary data from image (LSB of RGB channels)
                    let binaryData = '';
                    for (let i = 0; i < data.length; i += 4) {
                        for (let j = 0; j < 3; j++) {
                            // Get LSB from each color channel
                            binaryData += (data[i + j] & 1).toString();
                        }
                    }

                    // Check for header
                    const header = "STEG1";
                    const headerBinary = stringToBinary(header);
                    
                    if (binaryData.substring(0, headerBinary.length) !== headerBinary) {
                        alert('This image does not appear to contain a hidden message or it was created with a different tool.');
                        return;
                    }

                    // Get message length
                    const lengthBinary = binaryData.substring(headerBinary.length, headerBinary.length + 32);
                    const messageLength = parseInt(lengthBinary, 2);
                    
                    // Extract message binary
                    const messageBinary = binaryData.substring(headerBinary.length + 32, headerBinary.length + 32 + messageLength);
                    
                    // Convert binary to string
                    const encryptedMessage = binaryToString(messageBinary);
                    
                    // Decrypt message with password
                    const decryptedMessage = decryptMessage(encryptedMessage, password);
                    
                    // Display the message
                    messageDiv.textContent = decryptedMessage;
                    messageArea.classList.remove('invisible');
                    messageArea.classList.add('visible');
                } catch (error) {
                    console.error('Error reading message:', error);
                    alert('Error reading message. Make sure you used the correct password and the image contains a hidden message.');
                }
            };
            img.src = coverImage.src;
        }

        // Utility functions
        function stringToBinary(str) {
            return str.split('').map(char => {
                return char.charCodeAt(0).toString(2).padStart(8, '0');
            }).join('');
        }

        function binaryToString(binary) {
            let str = '';
            for (let i = 0; i < binary.length; i += 8) {
                const byte = binary.substr(i, 8);
                str += String.fromCharCode(parseInt(byte, 2));
            }
            return str;
        }

        function encryptMessage(message, password) {
            // Simple encryption using XOR with password (for demonstration)
            // In a real application, use a strong encryption algorithm like AES
            let result = '';
            for (let i = 0; i < message.length; i++) {
                const charCode = message.charCodeAt(i) ^ password.charCodeAt(i % password.length);
                result += String.fromCharCode(charCode);
            }
            return result;
        }

        function decryptMessage(encryptedMessage, password) {
            // Decryption using XOR (symmetric)
            return encryptMessage(encryptedMessage, password);
        }

        function copyText() {
            const textArea = document.createElement('textarea');
            textArea.value = messageDiv.textContent;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            alert('Message copied to clipboard!');
        }
    </script>
</body>
</html>